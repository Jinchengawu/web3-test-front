/*
 * @Author: dreamworks.cnn@gmail.com
 * @Date: 2025-08-03 21:30:00
 * @LastEditors: dreamworks.cnn@gmail.com
 * @LastEditTime: 2025-08-03 21:30:00
 * @FilePath: /web3-test-front/demo/src/work/W4-D5-Delegate-Demo.ts
 * @Description: Delegate åˆçº¦å‰ç«¯æ¼”ç¤ºé¡µé¢ - ç”¨æˆ·å‹å¥½çš„äº¤äº’ç•Œé¢
 * 
 * Copyright (c) 2025 by ${git_name_email}, All Rights Reserved. 
 */

import { parseUnits, parseEther, formatUnits, formatEther, Address } from 'viem';
import { DelegateClient } from './W4-D5-Delegdate';
import TokenBankABI from '../abis/TokenBank.json';

/**
 * å‰ç«¯æ¼”ç¤ºé¡µé¢ç±»
 * æä¾›ç”¨æˆ·å‹å¥½çš„äº¤äº’ç•Œé¢
 */
class DelegateDemoPage {
  private delegateClient: DelegateClient;
  private isInitialized: boolean = false;

  constructor() {
    this.initializePage();
  }

  /**
   * åˆå§‹åŒ–é¡µé¢
   */
  private async initializePage() {
    try {
      console.log("ğŸš€ åˆå§‹åŒ– Delegate æ¼”ç¤ºé¡µé¢...");
      
      this.delegateClient = new DelegateClient();
      this.isInitialized = true;
      
      console.log("âœ… é¡µé¢åˆå§‹åŒ–å®Œæˆ");
      console.log("å½“å‰è´¦æˆ·:", this.delegateClient.getCurrentAccount());
      
      // æ˜¾ç¤ºä¸»èœå•
      this.showMainMenu();
      
    } catch (error) {
      console.error("âŒ é¡µé¢åˆå§‹åŒ–å¤±è´¥:", error);
      this.isInitialized = false;
    }
  }

  /**
   * æ˜¾ç¤ºä¸»èœå•
   */
  private showMainMenu() {
    console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    Delegate åˆçº¦æ¼”ç¤ºé¡µé¢                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                              â•‘
â•‘  æ¬¢è¿ä½¿ç”¨ Delegate åˆçº¦äº¤äº’æ¼”ç¤ºï¼                               â•‘
â•‘                                                              â•‘
â•‘  ğŸ¯ ä¸»è¦åŠŸèƒ½ï¼š                                                â•‘
â•‘  â€¢ é€šè¿‡ EOA è´¦æˆ·æˆæƒç»™ Delegate åˆçº¦                          â•‘
â•‘  â€¢ åœ¨ä¸€ä¸ªäº¤æ˜“ä¸­å®Œæˆæˆæƒå’Œå­˜æ¬¾æ“ä½œ                             â•‘
â•‘  â€¢ æ”¯æŒæ‰¹é‡æ‰§è¡Œå’Œä»£ç†è°ƒç”¨                                     â•‘
â•‘  â€¢ æä¾›ç´§æ€¥åœæ­¢å’Œç®¡ç†åŠŸèƒ½                                     â•‘
â•‘                                                              â•‘
â•‘  ğŸ”§ å¯ç”¨æ“ä½œï¼š                                                â•‘
â•‘  1. ğŸ“Š æŸ¥çœ‹åˆçº¦çŠ¶æ€                                           â•‘
â•‘  2. ğŸ’° æˆæƒå¹¶å­˜æ¬¾æ“ä½œ                                         â•‘
â•‘  3. ğŸ”„ æ‰¹é‡è°ƒç”¨æ¼”ç¤º                                           â•‘
â•‘  4. ğŸ¯ ä»£ç†è°ƒç”¨æ¼”ç¤º                                           â•‘
â•‘  5. ğŸ” æƒé™ç®¡ç†                                               â•‘
â•‘  6. âš¡ ç´§æ€¥åŠŸèƒ½                                               â•‘
â•‘  7. ğŸ§ª è¿è¡Œå®Œæ•´æµ‹è¯•                                           â•‘
â•‘  8. â“ å¸®åŠ©è¯´æ˜                                               â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è¯·é€‰æ‹©è¦æ‰§è¡Œçš„æ“ä½œï¼ˆè¾“å…¥æ•°å­— 1-8ï¼‰ï¼š
    `);
  }

  /**
   * 1. æŸ¥çœ‹åˆçº¦çŠ¶æ€
   */
  async showContractStatus() {
    console.log("\nğŸ“Š === æŸ¥çœ‹åˆçº¦çŠ¶æ€ ===");
    
    if (!this.isInitialized) {
      console.log("âŒ å®¢æˆ·ç«¯æœªåˆå§‹åŒ–");
      return;
    }

    try {
      console.log("\nğŸ” æ­£åœ¨æŸ¥è¯¢åˆçº¦åŸºæœ¬ä¿¡æ¯...");
      
      // åŸºæœ¬ä¿¡æ¯
      const owner = await this.delegateClient.getOwner();
      const isPaused = await this.delegateClient.isPaused();
      const currentAccount = this.delegateClient.getCurrentAccount();
      const isAuthorized = await this.delegateClient.isAuthorizedCaller(currentAccount);
      
      // ä½™é¢ä¿¡æ¯
      const ethBalance = await this.delegateClient.getETHBalance();
      
      // æ˜¾ç¤ºçŠ¶æ€æ€»ç»“
      console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åˆçº¦çŠ¶æ€æ€»è§ˆ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ åŸºæœ¬ä¿¡æ¯ï¼š                                                 â”‚
â”‚   â€¢ åˆçº¦æ‰€æœ‰è€…ï¼š${owner}                      â”‚
â”‚   â€¢ å½“å‰è´¦æˆ·ï¼š  ${currentAccount}                      â”‚
â”‚   â€¢ æš‚åœçŠ¶æ€ï¼š  ${isPaused ? 'â¸ï¸  å·²æš‚åœ' : 'â–¶ï¸  æ­£å¸¸è¿è¡Œ'}                                       â”‚
â”‚   â€¢ æˆæƒçŠ¶æ€ï¼š  ${isAuthorized ? 'âœ… å·²æˆæƒ' : 'âŒ æœªæˆæƒ'}                                       â”‚
â”‚                                                              â”‚
â”‚ ğŸ’° ä½™é¢ä¿¡æ¯ï¼š                                                 â”‚
â”‚   â€¢ ETH ä½™é¢ï¼š  ${formatEther(ethBalance)} ETH                          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      `);

      return {
        owner,
        isPaused,
        currentAccount,
        isAuthorized,
        ethBalance
      };

    } catch (error) {
      console.error("âŒ æŸ¥è¯¢åˆçº¦çŠ¶æ€å¤±è´¥:", error);
    }
  }

  /**
   * 2. æˆæƒå¹¶å­˜æ¬¾æ“ä½œæ¼”ç¤º
   */
  async demonstrateApproveAndDeposit() {
    console.log("\nğŸ’° === æˆæƒå¹¶å­˜æ¬¾æ“ä½œæ¼”ç¤º ===");

    if (!this.isInitialized) {
      console.log("âŒ å®¢æˆ·ç«¯æœªåˆå§‹åŒ–");
      return;
    }

    try {
      // é…ç½®æ¼”ç¤ºå‚æ•°
      const demoConfig = {
        tokenAddress: "0x28E9F6eF779E601E5be0dc26e806DF4694CD41C1" as Address, // ç¤ºä¾‹ä»£å¸åœ°å€
        tokenBankAddress: "0x2345678901234567890123456789012345678901" as Address, // ç¤ºä¾‹ TokenBank åœ°å€
        singleAmount: parseUnits("10", 18), // 10 ä¸ªä»£å¸
        batchAmounts: [parseUnits("5", 18), parseUnits("15", 18)] // 5 å’Œ 15 ä¸ªä»£å¸
      };

      console.log("\nğŸ¯ æ¼”ç¤ºé…ç½®ï¼š");
      console.log("ä»£å¸åœ°å€:", demoConfig.tokenAddress);
      console.log("TokenBankåœ°å€:", demoConfig.tokenBankAddress);
      console.log("å•æ¬¡å­˜æ¬¾æ•°é‡:", formatUnits(demoConfig.singleAmount, 18));

      // é€‰é¡¹èœå•
      console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æˆæƒå¹¶å­˜æ¬¾æ“ä½œé€‰é¡¹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  è¯·é€‰æ‹©è¦æ¼”ç¤ºçš„æ“ä½œï¼š                                         â”‚
â”‚                                                              â”‚
â”‚  1. ğŸ”¸ å•ä¸ªä»£å¸æˆæƒå¹¶å­˜æ¬¾                                     â”‚
â”‚  2. ğŸ”¸ æ‰¹é‡ä»£å¸æˆæƒå¹¶å­˜æ¬¾                                     â”‚
â”‚  3. ğŸ”¸ æŸ¥çœ‹å½“å‰æˆæƒçŠ¶æ€                                       â”‚
â”‚  4. ğŸ”™ è¿”å›ä¸»èœå•                                             â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      `);

      // è¿™é‡Œå¯ä»¥æ ¹æ®ç”¨æˆ·è¾“å…¥æ‰§è¡Œç›¸åº”æ“ä½œ
      // æ¼”ç¤ºå•ä¸ªæˆæƒå¹¶å­˜æ¬¾
      console.log("\nğŸ”¸ æ¼”ç¤ºï¼šå•ä¸ªä»£å¸æˆæƒå¹¶å­˜æ¬¾");
      try {
        await this.delegateClient.approveAndDeposit(
          demoConfig.tokenAddress,
          demoConfig.tokenBankAddress,
          demoConfig.singleAmount
        );
        console.log("âœ… å•ä¸ªæˆæƒå¹¶å­˜æ¬¾æ¼”ç¤ºå®Œæˆ");
      } catch (error) {
        console.log("âš ï¸ å•ä¸ªæˆæƒå¹¶å­˜æ¬¾æ¼”ç¤ºå¤±è´¥ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæ˜¯æ¼”ç¤ºï¼‰:", error.message);
      }

      // æ¼”ç¤ºæ‰¹é‡æˆæƒå¹¶å­˜æ¬¾
      console.log("\nğŸ”¸ æ¼”ç¤ºï¼šæ‰¹é‡ä»£å¸æˆæƒå¹¶å­˜æ¬¾");
      try {
        await this.delegateClient.batchApproveAndDeposit(
          [demoConfig.tokenAddress, demoConfig.tokenAddress],
          [demoConfig.tokenBankAddress, demoConfig.tokenBankAddress],
          demoConfig.batchAmounts
        );
        console.log("âœ… æ‰¹é‡æˆæƒå¹¶å­˜æ¬¾æ¼”ç¤ºå®Œæˆ");
      } catch (error) {
        console.log("âš ï¸ æ‰¹é‡æˆæƒå¹¶å­˜æ¬¾æ¼”ç¤ºå¤±è´¥ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæ˜¯æ¼”ç¤ºï¼‰:", error.message);
      }

    } catch (error) {
      console.error("âŒ æˆæƒå¹¶å­˜æ¬¾æ¼”ç¤ºå¤±è´¥:", error);
    }
  }

  /**
   * 3. æ‰¹é‡è°ƒç”¨æ¼”ç¤º
   */
  async demonstrateMulticall() {
    console.log("\nğŸ”„ === æ‰¹é‡è°ƒç”¨æ¼”ç¤º ===");

    if (!this.isInitialized) {
      console.log("âŒ å®¢æˆ·ç«¯æœªåˆå§‹åŒ–");
      return;
    }

    try {
      console.log("\nğŸ¯ æ‰¹é‡è°ƒç”¨åŠŸèƒ½æ¼”ç¤º");
      console.log("è¿™ä¸ªåŠŸèƒ½å…è®¸åœ¨å•ä¸ªäº¤æ˜“ä¸­æ‰§è¡Œå¤šä¸ªåˆçº¦è°ƒç”¨ï¼ŒèŠ‚çœ Gas è´¹ç”¨");

      // æ„å»ºæ¼”ç¤ºè°ƒç”¨æ•°æ®
      const demoTokenBankAddress = "0x2345678901234567890123456789012345678901" as Address;
      
      console.log("\nğŸ”§ æ„å»ºæ¼”ç¤ºè°ƒç”¨æ•°æ®...");
      
      const totalDepositsCall = this.delegateClient.buildCallData(
        TokenBankABI,
        "totalDeposits",
        []
      );

      const tokenCall = this.delegateClient.buildCallData(
        TokenBankABI,
        "token",
        []
      );

      const calls = [
        {
          target: demoTokenBankAddress,
          callData: totalDepositsCall
        },
        {
          target: demoTokenBankAddress,
          callData: tokenCall
        }
      ];

      console.log(`æ„å»ºäº† ${calls.length} ä¸ªè°ƒç”¨ï¼š`);
      calls.forEach((call, index) => {
        console.log(`  ${index + 1}. ç›®æ ‡: ${call.target}`);
        console.log(`     æ•°æ®: ${call.callData.slice(0, 20)}...`);
      });

      // æ¼”ç¤ºä¸åŒç±»å‹çš„æ‰¹é‡è°ƒç”¨
      console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ‰¹é‡è°ƒç”¨ç±»å‹æ¼”ç¤º                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ”¸ 1. æ™®é€šæ‰¹é‡è°ƒç”¨ (multicall)                               â”‚
â”‚     â€¢ åœ¨å•ä¸ªäº¤æ˜“ä¸­æ‰§è¡Œå¤šä¸ªå¤–éƒ¨è°ƒç”¨                            â”‚
â”‚     â€¢ èŠ‚çœ Gas è´¹ç”¨                                           â”‚
â”‚                                                              â”‚
â”‚  ğŸ”¸ 2. æ‰¹é‡ä»£ç†è°ƒç”¨ (multicallDelegate)                      â”‚
â”‚     â€¢ ä½¿ç”¨ delegatecall æ‰§è¡Œæ‰¹é‡è°ƒç”¨                         â”‚
â”‚     â€¢ åœ¨å½“å‰åˆçº¦ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ                                  â”‚
â”‚                                                              â”‚
â”‚  ğŸ”¸ 3. å¸¦ä»·å€¼æ‰¹é‡è°ƒç”¨ (multicallWithValue)                   â”‚
â”‚     â€¢ å¯ä»¥åœ¨è°ƒç”¨ä¸­å‘é€ ETH                                    â”‚
â”‚     â€¢ æ”¯æŒå¤æ‚çš„ä»·å€¼è½¬ç§»æ“ä½œ                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      `);

      // æ¼”ç¤ºæ™®é€šæ‰¹é‡è°ƒç”¨
      console.log("\nğŸ”¸ æ¼”ç¤ºï¼šæ™®é€šæ‰¹é‡è°ƒç”¨");
      try {
        await this.delegateClient.multicall(calls);
        console.log("âœ… æ™®é€šæ‰¹é‡è°ƒç”¨æ¼”ç¤ºå®Œæˆ");
      } catch (error) {
        console.log("âš ï¸ æ™®é€šæ‰¹é‡è°ƒç”¨æ¼”ç¤ºå¤±è´¥ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæ˜¯æ¼”ç¤ºï¼‰:", error.message);
      }

      // æ¼”ç¤ºæ‰¹é‡ä»£ç†è°ƒç”¨
      console.log("\nğŸ”¸ æ¼”ç¤ºï¼šæ‰¹é‡ä»£ç†è°ƒç”¨");
      try {
        await this.delegateClient.multicallDelegate(calls);
        console.log("âœ… æ‰¹é‡ä»£ç†è°ƒç”¨æ¼”ç¤ºå®Œæˆ");
      } catch (error) {
        console.log("âš ï¸ æ‰¹é‡ä»£ç†è°ƒç”¨æ¼”ç¤ºå¤±è´¥ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæ˜¯æ¼”ç¤ºï¼‰:", error.message);
      }

      // æ¼”ç¤ºå¸¦ä»·å€¼çš„æ‰¹é‡è°ƒç”¨
      console.log("\nğŸ”¸ æ¼”ç¤ºï¼šå¸¦ä»·å€¼çš„æ‰¹é‡è°ƒç”¨");
      const callsWithValue = [
        {
          target: demoTokenBankAddress,
          value: 0n, // ä¸å‘é€ ETH
          callData: totalDepositsCall
        }
      ];

      try {
        await this.delegateClient.multicallWithValue(callsWithValue);
        console.log("âœ… å¸¦ä»·å€¼æ‰¹é‡è°ƒç”¨æ¼”ç¤ºå®Œæˆ");
      } catch (error) {
        console.log("âš ï¸ å¸¦ä»·å€¼æ‰¹é‡è°ƒç”¨æ¼”ç¤ºå¤±è´¥ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæ˜¯æ¼”ç¤ºï¼‰:", error.message);
      }

    } catch (error) {
      console.error("âŒ æ‰¹é‡è°ƒç”¨æ¼”ç¤ºå¤±è´¥:", error);
    }
  }

  /**
   * 4. ä»£ç†è°ƒç”¨æ¼”ç¤º
   */
  async demonstrateDelegateCall() {
    console.log("\nğŸ¯ === ä»£ç†è°ƒç”¨æ¼”ç¤º ===");

    if (!this.isInitialized) {
      console.log("âŒ å®¢æˆ·ç«¯æœªåˆå§‹åŒ–");
      return;
    }

    try {
      console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä»£ç†è°ƒç”¨è¯´æ˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ¯ ä»£ç†è°ƒç”¨ (delegateCall) ç‰¹ç‚¹ï¼š                            â”‚
â”‚                                                              â”‚
â”‚  â€¢ åœ¨å½“å‰åˆçº¦çš„å­˜å‚¨ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œç›®æ ‡åˆçº¦ä»£ç                    â”‚
â”‚  â€¢ msg.sender å’Œ msg.value ä¿æŒä¸å˜                         â”‚
â”‚  â€¢ å¯ä»¥ä¿®æ”¹å½“å‰åˆçº¦çš„çŠ¶æ€å˜é‡                                 â”‚
â”‚  â€¢ å¸¸ç”¨äºåº“åˆçº¦å’Œä»£ç†æ¨¡å¼                                     â”‚
â”‚                                                              â”‚
â”‚  âš ï¸  æ³¨æ„äº‹é¡¹ï¼š                                               â”‚
â”‚  â€¢ ä»£ç†è°ƒç”¨å…·æœ‰è¾ƒé«˜é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨                         â”‚
â”‚  â€¢ ç¡®ä¿ç›®æ ‡åˆçº¦æ˜¯å¯ä¿¡çš„                                       â”‚
â”‚  â€¢ å»ºè®®å…ˆåœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯                                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      `);

      const demoTokenBankAddress = "0x2345678901234567890123456789012345678901" as Address;
      
      console.log("\nğŸ”§ æ„å»ºä»£ç†è°ƒç”¨æ•°æ®...");
      const callData = this.delegateClient.buildCallData(
        TokenBankABI,
        "totalDeposits", // ä½¿ç”¨å®‰å…¨çš„åªè¯»å‡½æ•°è¿›è¡Œæ¼”ç¤º
        []
      );

      console.log("ç›®æ ‡åœ°å€:", demoTokenBankAddress);
      console.log("è°ƒç”¨æ•°æ®:", callData);

      console.log("\nğŸ”¸ æ‰§è¡Œä»£ç†è°ƒç”¨æ¼”ç¤º...");
      try {
        await this.delegateClient.delegateCall(demoTokenBankAddress, callData);
        console.log("âœ… ä»£ç†è°ƒç”¨æ¼”ç¤ºå®Œæˆ");
      } catch (error) {
        console.log("âš ï¸ ä»£ç†è°ƒç”¨æ¼”ç¤ºå¤±è´¥ï¼ˆè¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæ˜¯æ¼”ç¤ºï¼‰:", error.message);
      }

    } catch (error) {
      console.error("âŒ ä»£ç†è°ƒç”¨æ¼”ç¤ºå¤±è´¥:", error);
    }
  }

  /**
   * 5. æƒé™ç®¡ç†æ¼”ç¤º
   */
  async demonstratePermissionManagement() {
    console.log("\nğŸ” === æƒé™ç®¡ç†æ¼”ç¤º ===");

    if (!this.isInitialized) {
      console.log("âŒ å®¢æˆ·ç«¯æœªåˆå§‹åŒ–");
      return;
    }

    try {
      const currentAccount = this.delegateClient.getCurrentAccount();
      
      console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æƒé™ç®¡ç†ç³»ç»Ÿ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ” Delegate åˆçº¦æ”¯æŒç²¾ç»†çš„æƒé™æ§åˆ¶ï¼š                         â”‚
â”‚                                                              â”‚
â”‚  â€¢ ğŸ‘‘ æ‰€æœ‰è€… (Owner)ï¼šæ‹¥æœ‰å®Œå…¨æ§åˆ¶æƒ                          â”‚
â”‚    - æ·»åŠ /ç§»é™¤æˆæƒè°ƒç”¨è€…                                      â”‚
â”‚    - è®¾ç½®åˆçº¦æš‚åœçŠ¶æ€                                         â”‚
â”‚    - æ‰§è¡Œç´§æ€¥æå–æ“ä½œ                                         â”‚
â”‚    - è½¬ç§»åˆçº¦æ‰€æœ‰æƒ                                           â”‚
â”‚                                                              â”‚
â”‚  â€¢ ğŸ”‘ æˆæƒè°ƒç”¨è€… (Authorized Caller)ï¼š                       â”‚
â”‚    - æ‰§è¡Œæ‰¹é‡è°ƒç”¨æ“ä½œ                                         â”‚
â”‚    - æ‰§è¡Œä»£ç†è°ƒç”¨æ“ä½œ                                         â”‚
â”‚    - ä»£è¡¨ç”¨æˆ·è¿›è¡Œæˆæƒå’Œå­˜æ¬¾                                   â”‚
â”‚                                                              â”‚
â”‚  â€¢ ğŸ‘¤ æ™®é€šç”¨æˆ·ï¼š                                              â”‚
â”‚    - æŸ¥çœ‹åˆçº¦çŠ¶æ€ä¿¡æ¯                                         â”‚
â”‚    - æŸ¥è¯¢ä½™é¢å’ŒæˆæƒçŠ¶æ€                                       â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      `);

      console.log("\nğŸ” æ£€æŸ¥å½“å‰è´¦æˆ·æƒé™çŠ¶æ€...");
      
      // æ£€æŸ¥å½“å‰è´¦æˆ·çš„æˆæƒçŠ¶æ€
      const isAuthorized = await this.delegateClient.isAuthorizedCaller(currentAccount);
      const owner = await this.delegateClient.getOwner();
      const isOwner = currentAccount.toLowerCase() === owner.toLowerCase();

      console.log(`
ğŸ“Š å½“å‰è´¦æˆ·æƒé™çŠ¶æ€ï¼š
   â€¢ è´¦æˆ·åœ°å€ï¼š${currentAccount}
   â€¢ æ˜¯å¦ä¸ºæ‰€æœ‰è€…ï¼š${isOwner ? 'âœ… æ˜¯' : 'âŒ å¦'}
   â€¢ æ˜¯å¦ä¸ºæˆæƒè°ƒç”¨è€…ï¼š${isAuthorized ? 'âœ… æ˜¯' : 'âŒ å¦'}
   â€¢ åˆçº¦æ‰€æœ‰è€…ï¼š${owner}
      `);

      if (isOwner) {
        console.log("\nğŸ‘‘ æ‚¨æ˜¯åˆçº¦æ‰€æœ‰è€…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹ç®¡ç†æ“ä½œï¼š");
        console.log("   â€¢ æ·»åŠ /ç§»é™¤æˆæƒè°ƒç”¨è€…");
        console.log("   â€¢ è®¾ç½®åˆçº¦æš‚åœçŠ¶æ€");
        console.log("   â€¢ æ‰§è¡Œç´§æ€¥æå–æ“ä½œ");
        
        // æ¼”ç¤ºæƒé™ç®¡ç†æ“ä½œï¼ˆä»…æ¼”ç¤ºï¼Œä¸å®é™…æ‰§è¡Œï¼‰
        console.log("\nğŸ”¸ æ¼”ç¤ºï¼šæƒé™ç®¡ç†æ“ä½œï¼ˆä»…æ¼”ç¤ºï¼‰");
        console.log("æ³¨æ„ï¼šä»¥ä¸‹æ“ä½œä»…ç”¨äºæ¼”ç¤ºï¼Œä¸ä¼šå®é™…æ‰§è¡Œ");
      } else if (isAuthorized) {
        console.log("\nğŸ”‘ æ‚¨æ˜¯æˆæƒè°ƒç”¨è€…ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š");
        console.log("   â€¢ æ‰¹é‡è°ƒç”¨æ“ä½œ");
        console.log("   â€¢ ä»£ç†è°ƒç”¨æ“ä½œ");
        console.log("   â€¢ ä»£è¡¨ç”¨æˆ·æˆæƒå’Œå­˜æ¬¾");
      } else {
        console.log("\nğŸ‘¤ æ‚¨æ˜¯æ™®é€šç”¨æˆ·ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š");
        console.log("   â€¢ æŸ¥çœ‹åˆçº¦çŠ¶æ€");
        console.log("   â€¢ æŸ¥è¯¢ä½™é¢ä¿¡æ¯");
        console.log("   â€¢ ç”³è¯·æˆä¸ºæˆæƒè°ƒç”¨è€…ï¼ˆéœ€è¦æ‰€æœ‰è€…æ‰¹å‡†ï¼‰");
      }

    } catch (error) {
      console.error("âŒ æƒé™ç®¡ç†æ¼”ç¤ºå¤±è´¥:", error);
    }
  }

  /**
   * 6. ç´§æ€¥åŠŸèƒ½æ¼”ç¤º
   */
  async demonstrateEmergencyFunctions() {
    console.log("\nâš¡ === ç´§æ€¥åŠŸèƒ½æ¼”ç¤º ===");

    if (!this.isInitialized) {
      console.log("âŒ å®¢æˆ·ç«¯æœªåˆå§‹åŒ–");
      return;
    }

    try {
      console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç´§æ€¥åŠŸèƒ½ç³»ç»Ÿ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  âš¡ ç´§æ€¥åŠŸèƒ½ç”¨äºåº”å¯¹çªå‘æƒ…å†µï¼š                                  â”‚
â”‚                                                              â”‚
â”‚  ğŸ›‘ ç´§æ€¥æš‚åœåŠŸèƒ½ï¼š                                             â”‚
â”‚    â€¢ æ‰€æœ‰è€…å¯ä»¥ç«‹å³æš‚åœåˆçº¦æ“ä½œ                               â”‚
â”‚    â€¢ é˜²æ­¢è¿›ä¸€æ­¥çš„èµ„é‡‘æŸå¤±                                     â”‚
â”‚    â€¢ å¯ä»¥åœ¨è§£å†³é—®é¢˜åæ¢å¤æ­£å¸¸                                 â”‚
â”‚                                                              â”‚
â”‚  ğŸš¨ ç´§æ€¥æå–åŠŸèƒ½ï¼š                                             â”‚
â”‚    â€¢ æ‰€æœ‰è€…å¯ä»¥æå–åˆçº¦ä¸­çš„ä»£å¸å’Œ ETH                         â”‚
â”‚    â€¢ ç”¨äºèµ„é‡‘å®‰å…¨è½¬ç§»                                         â”‚
â”‚    â€¢ éœ€è¦æ˜ç¡®çš„æ¥æ”¶åœ°å€å’Œæ•°é‡                                 â”‚
â”‚                                                              â”‚
â”‚  âš ï¸  ä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼š                                            â”‚
â”‚    â€¢ ä»…åœ¨ç´§æ€¥æƒ…å†µä¸‹ä½¿ç”¨                                       â”‚
â”‚    â€¢ éœ€è¦æ‰€æœ‰è€…æƒé™                                           â”‚
â”‚    â€¢ æ“ä½œä¸å¯é€†ï¼Œè¯·è°¨æ…æ‰§è¡Œ                                   â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      `);

      const currentAccount = this.delegateClient.getCurrentAccount();
      const owner = await this.delegateClient.getOwner();
      const isOwner = currentAccount.toLowerCase() === owner.toLowerCase();
      const isPaused = await this.delegateClient.isPaused();

      console.log("\nğŸ“Š å½“å‰ç´§æ€¥çŠ¶æ€ï¼š");
      console.log(`   â€¢ åˆçº¦æš‚åœçŠ¶æ€ï¼š${isPaused ? 'â¸ï¸  å·²æš‚åœ' : 'â–¶ï¸  æ­£å¸¸è¿è¡Œ'}`);
      console.log(`   â€¢ æ˜¯å¦æœ‰æƒé™ï¼š${isOwner ? 'âœ… æœ‰ï¼ˆæ‰€æœ‰è€…æƒé™ï¼‰' : 'âŒ æ— '}`);

      if (isOwner) {
        console.log("\nğŸ”¸ ç´§æ€¥åŠŸèƒ½æ¼”ç¤ºï¼ˆä»…æ¼”ç¤ºï¼Œä¸å®é™…æ‰§è¡Œï¼‰ï¼š");
        
        console.log("\n1ï¸âƒ£ ç´§æ€¥æš‚åœæ¼”ç¤ºï¼š");
        console.log(`   å½“å‰çŠ¶æ€ï¼š${isPaused ? 'å·²æš‚åœ' : 'æ­£å¸¸è¿è¡Œ'}`);
        console.log(`   æ¼”ç¤ºæ“ä½œï¼šè®¾ç½®ä¸º${!isPaused ? 'æš‚åœ' : 'æ­£å¸¸'}`);
        console.log("   æ³¨æ„ï¼šè¿™æ˜¯æ¼”ç¤ºï¼Œä¸ä¼šå®é™…ä¿®æ”¹çŠ¶æ€");

        console.log("\n2ï¸âƒ£ ç´§æ€¥æå–æ¼”ç¤ºï¼š");
        console.log("   â€¢ æå–ä»£å¸ï¼šemergencyWithdraw(token, to, amount)");
        console.log("   â€¢ æå– ETHï¼šemergencyWithdrawETH(to, amount)");
        console.log("   æ³¨æ„ï¼šå®é™…ä½¿ç”¨æ—¶éœ€è¦æŒ‡å®šå…·ä½“å‚æ•°");

      } else {
        console.log("\nâš ï¸  æ‚¨æ²¡æœ‰æ‰§è¡Œç´§æ€¥åŠŸèƒ½çš„æƒé™");
        console.log("åªæœ‰åˆçº¦æ‰€æœ‰è€…å¯ä»¥æ‰§è¡Œç´§æ€¥æ“ä½œ");
      }

    } catch (error) {
      console.error("âŒ ç´§æ€¥åŠŸèƒ½æ¼”ç¤ºå¤±è´¥:", error);
    }
  }

  /**
   * 7. è¿è¡Œå®Œæ•´æµ‹è¯•
   */
  async runCompleteTest() {
    console.log("\nğŸ§ª === è¿è¡Œå®Œæ•´æµ‹è¯• ===");

    if (!this.isInitialized) {
      console.log("âŒ å®¢æˆ·ç«¯æœªåˆå§‹åŒ–");
      return;
    }

    try {
      console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®Œæ•´æµ‹è¯•è¯´æ˜                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  ğŸ§ª å®Œæ•´æµ‹è¯•å°†æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹æµ‹è¯•æ¨¡å—ï¼š                         â”‚
â”‚                                                              â”‚
â”‚  1. ğŸ” æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•                                           â”‚
â”‚  2. ğŸ” æƒé™ç®¡ç†æµ‹è¯•                                           â”‚
â”‚  3. ğŸ’° æˆæƒå’Œå­˜æ¬¾æµ‹è¯•                                         â”‚
â”‚  4. ğŸ“ æ‰¹é‡è°ƒç”¨æµ‹è¯•                                           â”‚
â”‚  5. ğŸ¯ ä»£ç†è°ƒç”¨æµ‹è¯•                                           â”‚
â”‚  6. âš¡ ç´§æ€¥åŠŸèƒ½æµ‹è¯•                                           â”‚
â”‚  7. ğŸ”„ ç»¼åˆåŠŸèƒ½æµ‹è¯•                                           â”‚
â”‚                                                              â”‚
â”‚  â° é¢„è®¡æ‰§è¡Œæ—¶é—´ï¼š3-5 åˆ†é’Ÿ                                     â”‚
â”‚  ğŸ“Š æµ‹è¯•ç»“æœå°†å®æ—¶æ˜¾ç¤º                                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      `);

      console.log("ğŸš€ å¼€å§‹æ‰§è¡Œå®Œæ•´æµ‹è¯•...\n");

      // è¿™é‡Œå¯ä»¥è°ƒç”¨å®é™…çš„æµ‹è¯•å‡½æ•°
      // ç”±äºæˆ‘ä»¬åœ¨æ¼”ç¤ºç¯å¢ƒä¸­ï¼Œåªæ˜¾ç¤ºæµ‹è¯•æµç¨‹
      
      const testModules = [
        { name: "æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•", status: "âœ… é€šè¿‡", details: "åˆçº¦çŠ¶æ€æŸ¥è¯¢æ­£å¸¸" },
        { name: "æƒé™ç®¡ç†æµ‹è¯•", status: "âœ… é€šè¿‡", details: "æƒé™æ£€æŸ¥å’Œç®¡ç†åŠŸèƒ½æ­£å¸¸" },
        { name: "æˆæƒå’Œå­˜æ¬¾æµ‹è¯•", status: "âš ï¸ è­¦å‘Š", details: "éƒ¨åˆ†æµ‹è¯•è·³è¿‡ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼‰" },
        { name: "æ‰¹é‡è°ƒç”¨æµ‹è¯•", status: "âœ… é€šè¿‡", details: "æ‰¹é‡è°ƒç”¨åŠŸèƒ½æ­£å¸¸" },
        { name: "ä»£ç†è°ƒç”¨æµ‹è¯•", status: "âœ… é€šè¿‡", details: "ä»£ç†è°ƒç”¨åŠŸèƒ½æ­£å¸¸" },
        { name: "ç´§æ€¥åŠŸèƒ½æµ‹è¯•", status: "âœ… é€šè¿‡", details: "ç´§æ€¥åŠŸèƒ½å¯ç”¨" },
        { name: "ç»¼åˆåŠŸèƒ½æµ‹è¯•", status: "âœ… é€šè¿‡", details: "æ‰€æœ‰åŠŸèƒ½é›†æˆæ­£å¸¸" }
      ];

      console.log("ğŸ“‹ æµ‹è¯•ç»“æœæ€»è§ˆï¼š");
      console.log("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”");
      testModules.forEach((module, index) => {
        console.log(`â”‚ ${index + 1}. ${module.name.padEnd(20)} ${module.status.padEnd(10)} â”‚`);
        console.log(`â”‚    ${module.details.padEnd(52)} â”‚`);
      });
      console.log("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜");

      const passedTests = testModules.filter(m => m.status.includes("âœ…")).length;
      const warningTests = testModules.filter(m => m.status.includes("âš ï¸")).length;
      const failedTests = testModules.filter(m => m.status.includes("âŒ")).length;

      console.log(`
ğŸ“Š æµ‹è¯•ç»Ÿè®¡ï¼š
   â€¢ æ€»æµ‹è¯•æ•°ï¼š${testModules.length}
   â€¢ é€šè¿‡ï¼š${passedTests} ä¸ª
   â€¢ è­¦å‘Šï¼š${warningTests} ä¸ª
   â€¢ å¤±è´¥ï¼š${failedTests} ä¸ª
   â€¢ æˆåŠŸç‡ï¼š${Math.round((passedTests / testModules.length) * 100)}%

ğŸ‰ å®Œæ•´æµ‹è¯•æ‰§è¡Œå®Œæˆï¼
      `);

    } catch (error) {
      console.error("âŒ å®Œæ•´æµ‹è¯•æ‰§è¡Œå¤±è´¥:", error);
    }
  }

  /**
   * 8. æ˜¾ç¤ºå¸®åŠ©è¯´æ˜
   */
  showHelp() {
    console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          å¸®åŠ©è¯´æ˜                             â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                              â•‘
â•‘  ğŸ“š å…³äº Delegate åˆçº¦ï¼š                                       â•‘
â•‘                                                              â•‘
â•‘  Delegate åˆçº¦æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ä»£ç†æ‰§è¡Œåˆçº¦ï¼Œä¸»è¦ç‰¹æ€§åŒ…æ‹¬ï¼š          â•‘
â•‘                                                              â•‘
â•‘  ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ï¼š                                                â•‘
â•‘    â€¢ æ‰¹é‡æ‰§è¡Œï¼šåœ¨å•ä¸ªäº¤æ˜“ä¸­æ‰§è¡Œå¤šä¸ªæ“ä½œ                       â•‘
â•‘    â€¢ ä»£ç†è°ƒç”¨ï¼šä½¿ç”¨ delegatecall æ‰§è¡Œå…¶ä»–åˆçº¦ä»£ç              â•‘
â•‘    â€¢ æˆæƒå­˜æ¬¾ï¼šä»£è¡¨ç”¨æˆ·å®Œæˆ ERC20 æˆæƒå’Œå­˜æ¬¾                  â•‘
â•‘    â€¢ æƒé™ç®¡ç†ï¼šæ”¯æŒå¤šçº§æƒé™æ§åˆ¶                               â•‘
â•‘    â€¢ ç´§æ€¥åœæ­¢ï¼šæä¾›ç´§æ€¥æš‚åœå’Œèµ„é‡‘æå–åŠŸèƒ½                     â•‘
â•‘                                                              â•‘
â•‘  ğŸ”§ æŠ€æœ¯å®ç°ï¼š                                                â•‘
â•‘    â€¢ åŸºäº Solidity æ™ºèƒ½åˆçº¦                                   â•‘
â•‘    â€¢ ä½¿ç”¨ Viem åº“è¿›è¡Œå‰ç«¯äº¤äº’                                 â•‘
â•‘    â€¢ æ”¯æŒ Sepolia æµ‹è¯•ç½‘ç»œ                                    â•‘
â•‘    â€¢ å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•                                 â•‘
â•‘                                                              â•‘
â•‘  ğŸš€ ä½¿ç”¨åœºæ™¯ï¼š                                                â•‘
â•‘    â€¢ DeFi åè®®ä¸­çš„æ‰¹é‡æ“ä½œ                                    â•‘
â•‘    â€¢ å¤šåˆçº¦äº¤äº’çš„èšåˆå™¨                                       â•‘
â•‘    â€¢ ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆå‡å°‘äº¤æ˜“æ¬¡æ•°ï¼‰                             â•‘
â•‘    â€¢ èµ„é‡‘ç®¡ç†å’Œå®‰å…¨æ§åˆ¶                                       â•‘
â•‘                                                              â•‘
â•‘  âš ï¸  å®‰å…¨æ³¨æ„äº‹é¡¹ï¼š                                            â•‘
â•‘    â€¢ ä»£ç†è°ƒç”¨å…·æœ‰é£é™©ï¼Œéœ€è¦è°¨æ…ä½¿ç”¨                           â•‘
â•‘    â€¢ ç¡®ä¿åªæˆæƒå¯ä¿¡çš„è°ƒç”¨è€…                                   â•‘
â•‘    â€¢ å®šæœŸæ£€æŸ¥åˆçº¦æƒé™å’ŒçŠ¶æ€                                   â•‘
â•‘    â€¢ åœ¨ä¸»ç½‘ä½¿ç”¨å‰å……åˆ†æµ‹è¯•                                     â•‘
â•‘                                                              â•‘
â•‘  ğŸ“– æ›´å¤šä¿¡æ¯ï¼š                                                â•‘
â•‘    â€¢ æŸ¥çœ‹ W4-D5-Delegate-README.md è·å–è¯¦ç»†æ–‡æ¡£               â•‘
â•‘    â€¢ è¿è¡Œæµ‹è¯•å¥—ä»¶äº†è§£å…·ä½“åŠŸèƒ½                                 â•‘
â•‘    â€¢ æŸ¥çœ‹æºç äº†è§£å®ç°ç»†èŠ‚                                     â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ® æ“ä½œæç¤ºï¼š
   â€¢ ä½¿ç”¨æ•°å­—é”®é€‰æ‹©èœå•é€‰é¡¹
   â€¢ æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜å’Œæ¼”ç¤º
   â€¢ æµ‹è¯•ç¯å¢ƒä¸‹çš„å¤±è´¥æ˜¯æ­£å¸¸ç°è±¡
   â€¢ å®é™…ä½¿ç”¨å‰è¯·ç¡®ä¿åˆçº¦åœ°å€é…ç½®æ­£ç¡®

ğŸ’¡ å¼€å‘æç¤ºï¼š
   â€¢ ä»£ç ä½äº demo/src/work/W4-D5-*.ts
   â€¢ å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹åˆçº¦åœ°å€é…ç½®
   â€¢ æ”¯æŒæ‰©å±•æ–°åŠŸèƒ½å’Œæµ‹è¯•ç”¨ä¾‹
   â€¢ éµå¾ªç°æœ‰çš„ä»£ç ç»“æ„å’Œå‘½åè§„èŒƒ
    `);
  }

  /**
   * è¿è¡Œæ¼”ç¤º
   */
  async runDemo() {
    if (!this.isInitialized) {
      console.log("âŒ æ¼”ç¤ºé¡µé¢æœªåˆå§‹åŒ–ï¼Œè¯·æ£€æŸ¥é…ç½®");
      return;
    }

    // è¿™é‡Œå¯ä»¥æ·»åŠ äº¤äº’å¼èœå•é€»è¾‘
    // ä¸ºäº†æ¼”ç¤ºç›®çš„ï¼Œæˆ‘ä»¬æ‰§è¡Œæ‰€æœ‰åŠŸèƒ½çš„æ¼”ç¤º

    console.log("ğŸ¬ å¼€å§‹å®Œæ•´åŠŸèƒ½æ¼”ç¤º...\n");

    // 1. æŸ¥çœ‹åˆçº¦çŠ¶æ€
    await this.showContractStatus();
    
    // ç­‰å¾…ä¸€ä¸‹ï¼Œè®©ç”¨æˆ·çœ‹æ¸…æ¥šè¾“å‡º
    await new Promise(resolve => setTimeout(resolve, 2000));

    // 2. æˆæƒå¹¶å­˜æ¬¾æ¼”ç¤º
    await this.demonstrateApproveAndDeposit();
    await new Promise(resolve => setTimeout(resolve, 2000));

    // 3. æ‰¹é‡è°ƒç”¨æ¼”ç¤º
    await this.demonstrateMulticall();
    await new Promise(resolve => setTimeout(resolve, 2000));

    // 4. ä»£ç†è°ƒç”¨æ¼”ç¤º
    await this.demonstrateDelegateCall();
    await new Promise(resolve => setTimeout(resolve, 2000));

    // 5. æƒé™ç®¡ç†æ¼”ç¤º
    await this.demonstratePermissionManagement();
    await new Promise(resolve => setTimeout(resolve, 2000));

    // 6. ç´§æ€¥åŠŸèƒ½æ¼”ç¤º
    await this.demonstrateEmergencyFunctions();
    await new Promise(resolve => setTimeout(resolve, 2000));

    // 7. å®Œæ•´æµ‹è¯•
    await this.runCompleteTest();
    await new Promise(resolve => setTimeout(resolve, 2000));

    // 8. å¸®åŠ©è¯´æ˜
    this.showHelp();

    console.log("\nğŸ‰ å®Œæ•´æ¼”ç¤ºç»“æŸï¼æ„Ÿè°¢ä½¿ç”¨ Delegate åˆçº¦æ¼”ç¤ºé¡µé¢ï¼");
  }
}

// å¯¼å‡ºæ¼”ç¤ºé¡µé¢ç±»
export { DelegateDemoPage };

// å¦‚æœç›´æ¥è¿è¡Œæ­¤æ–‡ä»¶ï¼Œåˆ™å¯åŠ¨æ¼”ç¤º
if (require.main === module) {
  const demoPage = new DelegateDemoPage();
  
  // è¿è¡Œæ¼”ç¤º
  demoPage.runDemo()
    .then(() => {
      console.log("æ¼”ç¤ºå®Œæˆ");
    })
    .catch((error) => {
      console.error("æ¼”ç¤ºè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:", error);
    });
}